<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ¸¬è©¦ ORS Directions API</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      button {
        font-size: 16px;
        padding: 10px 20px;
        cursor: pointer;
        margin: 10px 5px;
        border: none;
        border-radius: 5px;
        background-color: #007bff;
        color: white;
      }
      button:hover {
        background-color: #0056b3;
      }
      #results {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        white-space: pre-wrap;
        font-family: monospace;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }
    </style>
  </head>
  <body>
    <h1>æ¸¬è©¦ ORS Directions API</h1>
    <p>æ¸¬è©¦ä¸åŒçš„è·¯å¾‘è¦åŠƒå ´æ™¯ï¼Œé©—è­‰ API ä¿®æ­£æ˜¯å¦æœ‰æ•ˆã€‚</p>

    <button id="testTaipei">æ¸¬è©¦å°åŒ—å¸‚å€è·¯ç·š</button>
    <button id="testShort">æ¸¬è©¦çŸ­è·é›¢è·¯ç·š</button>
    <button id="testLong">æ¸¬è©¦é•·è·é›¢è·¯ç·š</button>
    <button id="testError">æ¸¬è©¦éŒ¯èª¤è™•ç†</button>

    <div id="results" class="info">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>

    <script>
      // API é…ç½®
      const apiKey = '5b3ce3597851110001cf6248cd3e1a052bec45bc8410b037091bb766';

      // å–å¾—é é¢å…ƒç´ 
      const resultsDiv = document.getElementById('results');
      const testTaipeiBtn = document.getElementById('testTaipei');
      const testShortBtn = document.getElementById('testShort');
      const testLongBtn = document.getElementById('testLong');
      const testErrorBtn = document.getElementById('testError');

      // é€šç”¨çš„è·¯ç·šè¦åŠƒå‡½æ•¸
      async function testRoute(coordinates, testName, profile = 'driving-car') {
        resultsDiv.className = 'info';
        resultsDiv.textContent = `æ­£åœ¨æ¸¬è©¦: ${testName}...`;

        try {
          console.log(`ğŸ›£ï¸ é–‹å§‹æ¸¬è©¦: ${testName}`);
          console.log('è·¯å¾‘é»åæ¨™:', coordinates);

          // ä½¿ç”¨ä¿®æ­£å¾Œçš„ API URL æ ¼å¼
          const apiUrl = `https://api.openrouteservice.org/v2/directions/${profile}/geojson`;

          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              Accept:
                'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',
              'Content-Type': 'application/json',
              Authorization: apiKey,
            },
            body: JSON.stringify({
              coordinates: coordinates,
            }),
          });

          if (!response.ok) {
            let errorMessage = `HTTP ${response.status}`;
            try {
              const errorData = await response.json();
              if (errorData.error && errorData.error.message) {
                errorMessage = errorData.error.message;
              }
            } catch (parseError) {
              errorMessage = `HTTP ${response.status} - ${response.statusText}`;
            }
            throw new Error(`ORS API éŒ¯èª¤: ${errorMessage}`);
          }

          const data = await response.json();

          if (!data.features || data.features.length === 0) {
            throw new Error('API è¿”å›çš„è·¯å¾‘æ•¸æ“šç‚ºç©º');
          }

          // è§£æçµæœ
          const summary = data.features[0].properties.summary;
          const distanceKm = (summary.distance / 1000).toFixed(2);
          const durationMin = Math.round(summary.duration / 60);

          // é¡¯ç¤ºæˆåŠŸçµæœ
          resultsDiv.className = 'success';
          resultsDiv.textContent = `âœ… ${testName} - æ¸¬è©¦æˆåŠŸï¼

è·¯å¾‘é»æ•¸é‡: ${coordinates.length} å€‹
ç¸½è·é›¢: ${distanceKm} å…¬é‡Œ
é ä¼°æ™‚é–“: ${durationMin} åˆ†é˜
äº¤é€šæ–¹å¼: ${profile}

è·¯å¾‘é»åæ¨™:
${coordinates.map((coord, index) => `  ${index + 1}. [${coord[0]}, ${coord[1]}]`).join('\n')}

API éŸ¿æ‡‰ç‹€æ…‹: ${response.status} ${response.statusText}
è¿”å›çš„ GeoJSON features: ${data.features.length} å€‹
å¹¾ä½•é¡å‹: ${data.features[0].geometry.type}`;

          console.log(`âœ… ${testName} æ¸¬è©¦æˆåŠŸ`);
          console.log(`ğŸ“ è·é›¢: ${distanceKm} å…¬é‡Œ`);
          console.log(`â±ï¸ æ™‚é–“: ${durationMin} åˆ†é˜`);
        } catch (error) {
          console.error(`âŒ ${testName} æ¸¬è©¦å¤±æ•—:`, error);

          resultsDiv.className = 'error';
          resultsDiv.textContent = `âŒ ${testName} - æ¸¬è©¦å¤±æ•—ï¼

éŒ¯èª¤è¨Šæ¯: ${error.message}

è·¯å¾‘é»åæ¨™:
${coordinates.map((coord, index) => `  ${index + 1}. [${coord[0]}, ${coord[1]}]`).join('\n')}

è«‹æª¢æŸ¥:
1. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸
2. API é‡‘é‘°æ˜¯å¦æœ‰æ•ˆ
3. è·¯å¾‘é»åæ¨™æ˜¯å¦æ­£ç¢º
4. æ˜¯å¦è¶…é API ä½¿ç”¨é™åˆ¶`;
        }
      }

      // æ¸¬è©¦æ¡ˆä¾‹ 1: å°åŒ—å¸‚å€è·¯ç·š (é¾å±±å¯º -> è¥¿é–€ç´…æ¨“ -> å°åŒ—è»Šç«™)
      testTaipeiBtn.addEventListener('click', () => {
        const coordinates = [
          [121.5, 25.0372], // é¾å±±å¯º
          [121.5073, 25.0428], // è¥¿é–€ç´…æ¨“
          [121.5175, 25.0479], // å°åŒ—è»Šç«™
        ];
        testRoute(coordinates, 'å°åŒ—å¸‚å€è·¯ç·šæ¸¬è©¦');
      });

      // æ¸¬è©¦æ¡ˆä¾‹ 2: çŸ­è·é›¢è·¯ç·š (2å€‹é»)
      testShortBtn.addEventListener('click', () => {
        const coordinates = [
          [121.5654, 25.033], // å°åŒ—101é™„è¿‘
          [121.57, 25.035], // é™„è¿‘å¦ä¸€é»
        ];
        testRoute(coordinates, 'çŸ­è·é›¢è·¯ç·šæ¸¬è©¦');
      });

      // æ¸¬è©¦æ¡ˆä¾‹ 3: é•·è·é›¢è·¯ç·š (å°åŒ—åˆ°æ¡ƒåœ’)
      testLongBtn.addEventListener('click', () => {
        const coordinates = [
          [121.5175, 25.0479], // å°åŒ—è»Šç«™
          [121.2168, 24.9539], // æ¡ƒåœ’è»Šç«™
        ];
        testRoute(coordinates, 'é•·è·é›¢è·¯ç·šæ¸¬è©¦');
      });

      // æ¸¬è©¦æ¡ˆä¾‹ 4: éŒ¯èª¤è™•ç† (ç„¡æ•ˆåæ¨™)
      testErrorBtn.addEventListener('click', () => {
        const coordinates = [
          [999, 999], // ç„¡æ•ˆåæ¨™
          [888, 888], // ç„¡æ•ˆåæ¨™
        ];
        testRoute(coordinates, 'éŒ¯èª¤è™•ç†æ¸¬è©¦');
      });
    </script>
  </body>
</html>
