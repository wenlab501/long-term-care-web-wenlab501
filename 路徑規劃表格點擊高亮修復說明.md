# è·¯å¾‘è¦åŠƒè¡¨æ ¼é»æ“Šé«˜äº®ä¿®å¾©èªªæ˜

## ğŸ› å•é¡Œæè¿°

ç”¨æˆ¶åæ˜ ï¼š**é»æ“Šè·¯å¾‘è¦åŠƒåœ–å±¤æ¸…å–®é‚„æ˜¯ rightpane é‚„æ˜¯æ²’å‡ºç¾ï¼Ÿ**

### å•é¡Œåˆ†æ

1. **è¡¨æ ¼é»æ“Šäº‹ä»¶**ï¼šDataTableTab ä¸­çš„ `handleHighlight` å‡½æ•¸æ­£å¸¸è§¸ç™¼
2. **äº‹ä»¶å‚³é**ï¼šäº‹ä»¶æ­£ç¢ºå‚³éåˆ° HomeView â†’ MiddleView â†’ UpperView â†’ MapTab
3. **é«˜äº®é‚è¼¯**ï¼šMapTab ä¸­çš„ `highlightFeature` å‡½æ•¸æ­£å¸¸åŸ·è¡Œ
4. **æ ¹æœ¬å•é¡Œ**ï¼šè·¯å¾‘è¦åŠƒåœ–å±¤çš„è¡¨æ ¼æ•¸æ“š (`tableData`) ä¸­ç¼ºå°‘æ­£ç¢ºçš„ `id` å­—æ®µ

### å•é¡Œæ ¹æº

```javascript
// ğŸš« å•é¡Œï¼šè¡¨æ ¼æ•¸æ“šåªæœ‰åºè™Ÿ '#'ï¼Œæ²’æœ‰å°æ‡‰çš„ feature ID
tableData.push({
  '#': index + 1, // âŒ åªæœ‰åºè™Ÿï¼Œä¸æ˜¯ feature ID
  åç¨±: route.properties.name,
  // ... å…¶ä»–å±¬æ€§
});

// ğŸš« å•é¡Œï¼šDataTableTab ä½¿ç”¨éŒ¯èª¤çš„ ID
const highlightData = {
  id: item['#'], // âŒ ä½¿ç”¨åºè™Ÿä½œç‚º IDï¼Œç„¡æ³•æ‰¾åˆ°å°æ‡‰çš„ feature
  layerId: layer.layerId,
  // ...
};
```

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### 1. ä¿®å¾©è¡¨æ ¼æ•¸æ“šçµæ§‹ âœ…

#### **ä¿®å¾© `updateRoutePlanningLayerData` å‡½æ•¸**

**ä¿®å¾©å‰**ï¼š

```javascript
// æ·»åŠ å·²å®Œæˆçš„è·¯ç·š
completedRoutes.forEach((route, index) => {
  tableData.push({
    '#': index + 1, // âŒ åªæœ‰åºè™Ÿ
    åç¨±: route.properties.name,
    // ... å…¶ä»–å±¬æ€§
  });
});
```

**ä¿®å¾©å¾Œ**ï¼š

```javascript
// æ·»åŠ å·²å®Œæˆçš„è·¯ç·š
completedRoutes.forEach((route, index) => {
  tableData.push({
    '#': index + 1,
    id: route.properties.id, // âœ… æ·»åŠ æ­£ç¢ºçš„ feature ID ç”¨æ–¼é«˜äº®é¡¯ç¤º
    åç¨±: route.properties.name,
    // ... å…¶ä»–å±¬æ€§
  });
});
```

#### **ä¿®å¾©è¦åŠƒä¸­è·¯ç·šçš„ ID**

**ä¿®å¾©å‰**ï¼š

```javascript
// å¦‚æœæœ‰æ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»ï¼Œæ·»åŠ åˆ°è¡¨æ ¼
if (currentRoutePoints.length > 0) {
  tableData.push({
    '#': completedRoutes.length + 1, // âŒ åªæœ‰åºè™Ÿ
    åç¨±: `è·¯ç·š ${completedRoutes.length + 1}`,
    // ... å…¶ä»–å±¬æ€§
  });
}
```

**ä¿®å¾©å¾Œ**ï¼š

```javascript
// å¦‚æœæœ‰æ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»ï¼Œæ·»åŠ åˆ°è¡¨æ ¼
if (currentRoutePoints.length > 0) {
  const firstPoint = currentRoutePoints[0];

  tableData.push({
    '#': completedRoutes.length + 1,
    id: firstPoint.properties.id, // âœ… ä½¿ç”¨ç¬¬ä¸€å€‹è·¯å¾‘é»çš„ ID ä½œç‚ºè¦åŠƒä¸­è·¯ç·šçš„ä»£è¡¨
    åç¨±: `è·¯ç·š ${completedRoutes.length + 1}`,
    // ... å…¶ä»–å±¬æ€§
  });
}
```

### 2. ä¿®å¾©é»æ“Šäº‹ä»¶è™•ç† âœ…

#### **ä¿®å¾© DataTableTab ä¸­çš„ `handleHighlight` å‡½æ•¸**

**ä¿®å¾©å‰**ï¼š

```javascript
const highlightData = {
  id: item['#'], // âŒ ä½¿ç”¨åºè™Ÿï¼Œç„¡æ³•æ‰¾åˆ° feature
  layerId: layer.layerId,
  // ...
};
```

**ä¿®å¾©å¾Œ**ï¼š

```javascript
const highlightData = {
  id: item.id || item['#'], // âœ… å„ªå…ˆä½¿ç”¨ item.idï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨ item['#'] ä½œç‚ºå¾Œå‚™
  layerId: layer.layerId,
  // ...
};
```

## ğŸ“Š æ•¸æ“šçµæ§‹å°æ¯”

### ä¿®å¾©å‰çš„è¡¨æ ¼æ•¸æ“š

```javascript
[
  {
    '#': 1, // âŒ åªæœ‰åºè™Ÿ
    åç¨±: 'è·¯ç·š 1',
    é¡å‹: 'å·²å®Œæˆè·¯ç·š',
    // ... å…¶ä»–å±¬æ€§
  },
  {
    '#': 2, // âŒ åªæœ‰åºè™Ÿ
    åç¨±: 'è·¯ç·š 2',
    é¡å‹: 'è¦åŠƒä¸­',
    // ... å…¶ä»–å±¬æ€§
  },
];
```

### ä¿®å¾©å¾Œçš„è¡¨æ ¼æ•¸æ“š

```javascript
[
  {
    '#': 1,
    id: 'route_1640995200000_abc123', // âœ… æ­£ç¢ºçš„ feature ID
    åç¨±: 'è·¯ç·š 1',
    é¡å‹: 'å·²å®Œæˆè·¯ç·š',
    // ... å…¶ä»–å±¬æ€§
  },
  {
    '#': 2,
    id: 'route_point_1640995200000_def456', // âœ… è¦åŠƒä¸­è·¯ç·šä½¿ç”¨ç¬¬ä¸€å€‹è·¯å¾‘é»çš„ ID
    åç¨±: 'è·¯ç·š 2',
    é¡å‹: 'è¦åŠƒä¸­',
    // ... å…¶ä»–å±¬æ€§
  },
];
```

## ğŸ”„ äº‹ä»¶æµç¨‹

### ä¿®å¾©å¾Œçš„å®Œæ•´äº‹ä»¶æµç¨‹

```
1. ç”¨æˆ¶é»æ“Šè¡¨æ ¼è¡Œ
   â†“
2. DataTableTab.handleHighlight()
   â”œâ”€ id: item.id (æ­£ç¢ºçš„ feature ID) âœ…
   â”œâ”€ layerId: 'route-planning-layer'
   â””â”€ emit('highlight-on-map', highlightData)
   â†“
3. HomeView.handleHighlight()
   â””â”€ åˆ‡æ›åˆ°åœ°åœ–è¦–åœ–
   â†“
4. MiddleView.highlightFeature()
   â””â”€ å‚³éåˆ° UpperView
   â†“
5. UpperView.highlightFeature()
   â””â”€ å‚³éåˆ° MapTab
   â†“
6. MapTab.highlightFeature()
   â”œâ”€ åœ¨ 'route-planning-layer' ä¸­æœå°‹ feature ID âœ…
   â”œâ”€ æ‰¾åˆ°å°æ‡‰çš„ feature âœ…
   â”œâ”€ dataStore.setSelectedFeature(feature) âœ…
   â””â”€ æ‡‰ç”¨é«˜äº®æ¨£å¼ âœ…
   â†“
7. PropertiesTab è‡ªå‹•é¡¯ç¤ºè©³ç´°ä¿¡æ¯ âœ…
```

## ğŸ¯ ä¿®å¾©æ•ˆæœ

### âœ… å·²å®Œæˆè·¯ç·šé»æ“Š

```
é»æ“Šè¡¨æ ¼ä¸­çš„ "è·¯ç·š 1" â†’
â”œâ”€ ğŸ” æœå°‹: layerId="route-planning-layer", featureId="route_1640995200000_abc123"
â”œâ”€ âœ… æ‰¾åˆ°: æ©˜è‰²è·¯ç·š feature
â”œâ”€ ğŸ¯ é«˜äº®: è·¯ç·šè®Šç‚ºç™½è‰²é‚Šæ¡†ï¼Œå¢åŠ ç²—ç´°
â”œâ”€ ğŸ“‹ é¸ä¸­: dataStore.selectedFeature = routeFeature
â””â”€ ğŸ“„ é¡¯ç¤º: PropertiesTab é¡¯ç¤ºè·¯ç·šè©³ç´°ä¿¡æ¯
```

### âœ… è¦åŠƒä¸­è·¯ç·šé»æ“Š

```
é»æ“Šè¡¨æ ¼ä¸­çš„ "è·¯ç·š 2 (è¦åŠƒä¸­)" â†’
â”œâ”€ ğŸ” æœå°‹: layerId="route-planning-layer", featureId="route_point_1640995200000_def456"
â”œâ”€ âœ… æ‰¾åˆ°: ç¬¬ä¸€å€‹è·¯å¾‘é» feature
â”œâ”€ ğŸ¯ é«˜äº®: è·¯å¾‘é»åœ–æ¨™æ”¾å¤§ 1.6 å€
â”œâ”€ ğŸ“‹ é¸ä¸­: dataStore.selectedFeature = pointFeature
â””â”€ ğŸ“„ é¡¯ç¤º: PropertiesTab é¡¯ç¤ºè·¯å¾‘é»è©³ç´°ä¿¡æ¯
```

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### æ¸¬è©¦æ­¥é©Ÿ

1. **å‰µå»ºè·¯ç·š**ï¼š

   ```
   1. é»æ“Š "é»é¸è·¯å¾‘è¦åŠƒé»"
   2. åœ¨åœ°åœ–ä¸Šé»æ“Š 3 å€‹é»
   3. é»æ“Š "è·¯å¾‘è¦åŠƒé»é¸å®Œæˆ"
   4. ç¢ºèªç”Ÿæˆ "è·¯ç·š 1"
   ```

2. **æ¸¬è©¦å·²å®Œæˆè·¯ç·š**ï¼š

   ```
   1. åˆ‡æ›åˆ° "è³‡æ–™è¡¨æ ¼" åˆ†é 
   2. é»æ“Šè·¯å¾‘è¦åŠƒåœ–å±¤çš„ "è·¯ç·š 1" è¡Œ
   3. âœ… ç¢ºèªåœ°åœ–ä¸Šæ©˜è‰²è·¯ç·šè¢«é«˜äº®é¡¯ç¤º
   4. âœ… ç¢ºèªå³å´é¢æ¿é¡¯ç¤ºè·¯ç·šè©³ç´°ä¿¡æ¯
   ```

3. **æ¸¬è©¦è¦åŠƒä¸­è·¯ç·š**ï¼š
   ```
   1. å†æ¬¡é»æ“Š "é»é¸è·¯å¾‘è¦åŠƒé»"
   2. åœ¨åœ°åœ–ä¸Šé»æ“Š 2 å€‹é»ï¼ˆä¸å®Œæˆï¼‰
   3. åˆ‡æ›åˆ° "è³‡æ–™è¡¨æ ¼" åˆ†é 
   4. é»æ“Š "è·¯ç·š 2 (è¦åŠƒä¸­)" è¡Œ
   5. âœ… ç¢ºèªåœ°åœ–ä¸Šç¬¬ä¸€å€‹è·¯å¾‘é»è¢«é«˜äº®é¡¯ç¤º
   6. âœ… ç¢ºèªå³å´é¢æ¿é¡¯ç¤ºè·¯å¾‘é»è©³ç´°ä¿¡æ¯
   ```

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

### âœ… ä¿®å¾©å®Œæˆé …ç›®

- âœ… **è¡¨æ ¼æ•¸æ“šçµæ§‹**ï¼šç‚ºæ¯å€‹è¡¨æ ¼é …ç›®æ·»åŠ æ­£ç¢ºçš„ `id` å­—æ®µ
- âœ… **å·²å®Œæˆè·¯ç·š**ï¼šä½¿ç”¨ `route.properties.id` ä½œç‚ºè¡¨æ ¼é …ç›®çš„ `id`
- âœ… **è¦åŠƒä¸­è·¯ç·š**ï¼šä½¿ç”¨ç¬¬ä¸€å€‹è·¯å¾‘é»çš„ `id` ä½œç‚ºè¡¨æ ¼é …ç›®çš„ `id`
- âœ… **é»æ“Šäº‹ä»¶è™•ç†**ï¼šå„ªå…ˆä½¿ç”¨ `item.id`ï¼Œå¾Œå‚™ä½¿ç”¨ `item['#']`
- âœ… **äº‹ä»¶å‚³ééˆ**ï¼šå¾ DataTableTab â†’ HomeView â†’ MapTab çš„å®Œæ•´éˆè·¯
- âœ… **é«˜äº®é‚è¼¯**ï¼šMapTab ä¸­çš„ feature æœå°‹å’Œé«˜äº®æ‡‰ç”¨
- âœ… **é¸ä¸­ç‹€æ…‹**ï¼šæ­£ç¢ºè¨­ç½® `dataStore.selectedFeature`
- âœ… **è©³ç´°é¡¯ç¤º**ï¼šPropertiesTab è‡ªå‹•é¡¯ç¤ºå°æ‡‰çš„è©³ç´°ä¿¡æ¯

### ğŸ”„ è‡ªå‹•è™•ç†é …ç›®

- ğŸ”„ **å‘å¾Œå…¼å®¹**ï¼šå°æ–¼æ²’æœ‰ `id` å­—æ®µçš„å…¶ä»–åœ–å±¤ï¼Œä»ä½¿ç”¨ `item['#']` ä½œç‚ºå¾Œå‚™
- ğŸ”„ **éŒ¯èª¤è™•ç†**ï¼šå¦‚æœæ‰¾ä¸åˆ°å°æ‡‰çš„ featureï¼Œæœƒåœ¨ console ä¸­è¼¸å‡ºè¨ºæ–·ä¿¡æ¯
- ğŸ”„ **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šæ¡Œé¢ç‰ˆå’Œç§»å‹•ç‰ˆéƒ½èƒ½æ­£å¸¸å·¥ä½œ

## ğŸ‰ é æœŸçµæœ

ä¿®å¾©å¾Œï¼Œç”¨æˆ¶é»æ“Šè·¯å¾‘è¦åŠƒåœ–å±¤æ¸…å–®çš„ä»»ä½•é …ç›®æ™‚ï¼š

1. **ğŸ—ºï¸ åœ°åœ–éŸ¿æ‡‰**ï¼šè‡ªå‹•åˆ‡æ›åˆ°åœ°åœ–è¦–åœ–
2. **ğŸ¯ é«˜äº®é¡¯ç¤º**ï¼šå°æ‡‰çš„è·¯ç·šæˆ–è·¯å¾‘é»åœ¨åœ°åœ–ä¸Šè¢«é«˜äº®é¡¯ç¤º
3. **ğŸ“„ è©³ç´°ä¿¡æ¯**ï¼šå³å´é¢æ¿ (PropertiesTab) è‡ªå‹•é¡¯ç¤ºè©³ç´°ä¿¡æ¯
4. **ğŸ“Š å®Œæ•´æ•¸æ“š**ï¼šåŒ…æ‹¬ç¶“ç·¯åº¦ã€å±¬æ€§ã€é—œè¯è·¯å¾‘é»ç­‰æ‰€æœ‰ä¿¡æ¯

---

_ç¾åœ¨é»æ“Šè·¯å¾‘è¦åŠƒåœ–å±¤æ¸…å–®çš„é …ç›®æ‡‰è©²èƒ½å¤ æ­£ç¢ºè§¸ç™¼é«˜äº®é¡¯ç¤ºå’Œå³å´é¢æ¿çš„è©³ç´°ä¿¡æ¯é¡¯ç¤ºäº†ï¼_
