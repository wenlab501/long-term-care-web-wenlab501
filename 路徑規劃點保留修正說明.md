# è·¯å¾‘è¦åŠƒé»ä¿ç•™ä¿®æ­£èªªæ˜

## ğŸ¯ å•é¡Œæè¿°

ç”¨æˆ¶åæ˜ ã€Œè¦åŠƒé»é‚„æ˜¯æ²’æœ‰ç•™åœ¨åœ°åœ–ä¸Šã€ï¼ŒåŸå› æ˜¯ä¹‹å‰çš„å¯¦ç¾æœƒåœ¨è·¯å¾‘è¦åŠƒå®Œæˆå¾Œæ¸…ç©ºæ‰€æœ‰è·¯å¾‘è¦åŠƒé»ï¼Œå°è‡´ç”¨æˆ¶ç„¡æ³•çœ‹åˆ°å·²å®Œæˆè·¯ç·šçš„è·¯å¾‘é»ã€‚

## ğŸ”§ ä¿®æ­£æ–¹æ¡ˆ

### æ ¸å¿ƒæ¦‚å¿µï¼šè·¯å¾‘é»ç‹€æ…‹ç®¡ç†

å°‡è·¯å¾’è¦åŠƒé»åˆ†ç‚ºå…©ç¨®ç‹€æ…‹ï¼š

- **è¦åŠƒä¸­** (`status` æœªè¨­ç½®æˆ–ä¸ç­‰æ–¼ `'completed'`)ï¼šæ©˜è‰²é¡¯ç¤ºï¼Œå¯ä»¥ç¹¼çºŒç·¨è¼¯
- **å·²å®Œæˆ** (`status === 'completed'`)ï¼šç°è‰²é¡¯ç¤ºï¼Œé—œè¯åˆ°ç‰¹å®šè·¯ç·š

## ğŸ“ å…·é«”ä¿®æ­£å…§å®¹

### 1. ä¿®æ”¹è·¯ç·šå®Œæˆé‚è¼¯ âœ…

**ä¿®æ­£å‰ï¼šæ¸…ç©ºè·¯å¾‘é»**

```javascript
// ğŸ”¥ é—œéµä¿®æ”¹ï¼šæ¸…é™¤ç•¶å‰çš„è·¯å¾‘è¦åŠƒé»ï¼Œæº–å‚™ä¸‹ä¸€æ¬¡è¦åŠƒ
routePlanningLayer.geoJsonData.features =
  routePlanningLayer.geoJsonData.features.filter(
    (f) => f.properties.type !== 'route-planning-point'
  );
```

**ä¿®æ­£å¾Œï¼šæ¨™è¨˜ç‚ºå·²å®Œæˆ**

```javascript
// ğŸ”¥ ä¿®æ”¹ï¼šå°‡ç•¶å‰è·¯å¾‘è¦åŠƒé»æ¨™è¨˜ç‚ºå·²å®Œæˆï¼Œä½†ä¿ç•™åœ¨åœ°åœ–ä¸Š
routePlanningLayer.geoJsonData.features.forEach((feature) => {
  if (feature.properties.type === 'route-planning-point') {
    // å°‡è·¯å¾‘é»æ¨™è¨˜ç‚ºå·²å®Œæˆï¼Œé—œè¯åˆ°å°æ‡‰çš„è·¯ç·š
    feature.properties.status = 'completed';
    feature.properties.routeId = routeId;
    feature.properties.routeNumber = routeNumber;
  }
});
```

### 2. ä¿®æ”¹æ•¸æ“šéæ¿¾é‚è¼¯ âœ…

æ‰€æœ‰æ¶‰åŠè·¯å¾‘é»è¨ˆç®—çš„å‡½æ•¸éƒ½éœ€è¦å€åˆ†ç‹€æ…‹ï¼š

#### `updateRoutePlanningLayerData`

```javascript
// ç²å–ç•¶å‰æ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»ï¼ˆæ’é™¤å·²å®Œæˆçš„ï¼‰
const currentRoutePoints = routePlanningLayer.geoJsonData.features.filter(
  (f) =>
    f.properties.type === 'route-planning-point' &&
    f.properties.status !== 'completed'
);
```

#### `addRoutePlanningPoint`

```javascript
// è¨ˆç®—ç•¶å‰æ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»æ•¸é‡ï¼Œç”¨æ–¼ç”Ÿæˆé †åºç·¨è™Ÿï¼ˆæ’é™¤å·²å®Œæˆçš„ï¼‰
const currentPoints = routePlanningLayer.geoJsonData.features.filter(
  (f) =>
    f.properties.type === 'route-planning-point' &&
    f.properties.status !== 'completed'
);
```

#### `getRoutePlanningCoordinates`

```javascript
// ç²å–æ­£åœ¨è¦åŠƒä¸­çš„è·¯å¾‘è¦åŠƒé»ï¼Œä¸¦æŒ‰é †åºæ’åºï¼ˆæ’é™¤å·²å®Œæˆçš„ï¼‰
const routePoints = routePlanningLayer.geoJsonData.features
  .filter(
    (f) =>
      f.properties.type === 'route-planning-point' &&
      f.properties.status !== 'completed'
  )
  .sort((a, b) => a.properties.order - b.properties.order);
```

### 3. è¦–è¦ºæ¨£å¼å€åˆ† âœ…

#### è·¯å¾‘é»åœ–æ¨™æ¨£å¼

**æ­£åœ¨è¦åŠƒä¸­çš„è·¯å¾‘é»**ï¼š

```javascript
// æ©˜è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—ï¼Œç™½è‰²é‚Šæ¡†
const backgroundColor = 'var(--my-color-orange)';
const borderColor = 'white';
const textColor = 'var(--my-color-white)';
```

**å·²å®Œæˆçš„è·¯å¾‘é»**ï¼š

```javascript
// ç°è‰²èƒŒæ™¯ï¼Œæ·ºç°è‰²æ–‡å­—ï¼Œç°è‰²é‚Šæ¡†
const backgroundColor = 'var(--my-color-gray-500)';
const borderColor = 'var(--my-color-gray-400)';
const textColor = 'var(--my-color-gray-200)';
```

#### å‹•æ…‹æ¨£å¼æ‡‰ç”¨

```javascript
const isCompleted = feature.properties.status === 'completed';

// æ ¹æ“šå®Œæˆç‹€æ…‹é¸æ“‡ä¸åŒçš„æ¨£å¼
const backgroundColor = isCompleted
  ? 'var(--my-color-gray-500)'
  : 'var(--my-color-orange)';
const borderColor = isCompleted ? 'var(--my-color-gray-400)' : 'white';
const textColor = isCompleted
  ? 'var(--my-color-gray-200)'
  : 'var(--my-color-white)';
```

### 4. å½ˆå‡ºè¦–çª—å¢å¼· âœ…

#### å·²å®Œæˆè·¯å¾‘é»çš„å½ˆå‡ºè¦–çª—

```html
<div class="">
  <div class="my-title-xs-gray pb-2">è·¯å¾‘è¦åŠƒåœ–å±¤</div>
  <div class="my-content-sm-black">è·¯å¾‘é» 1</div>
  <div class="my-content-xs-gray pt-1">é †åº: 1</div>
  <div class="my-content-xs-gray">æ‰€å±¬è·¯ç·š: è·¯ç·š 1</div>
  <div class="my-content-xs-gray">ç‹€æ…‹: å·²å®Œæˆ</div>
</div>
```

#### è¦åŠƒä¸­è·¯å¾‘é»çš„å½ˆå‡ºè¦–çª—

```html
<div class="">
  <div class="my-title-xs-gray pb-2">è·¯å¾‘è¦åŠƒåœ–å±¤</div>
  <div class="my-content-sm-black">è·¯å¾‘é» 1</div>
  <div class="my-content-xs-gray pt-1">é †åº: 1</div>
  <div class="my-content-xs-gray">ç‹€æ…‹: è¦åŠƒä¸­</div>
</div>
```

### 5. æ¸…ç©ºåŠŸèƒ½å„ªåŒ– âœ…

#### ä¿®æ”¹ `clearRoutePlanningLayer` å‡½æ•¸

```javascript
const clearRoutePlanningLayer = (clearAll = false) => {
  const routePlanningLayer = findLayerById('route-planning-layer');
  if (routePlanningLayer) {
    if (clearAll) {
      // æ¸…ç©ºæ‰€æœ‰å…§å®¹ï¼ˆè·¯å¾‘é» + è·¯ç·šï¼‰
      routePlanningLayer.geoJsonData.features = [];
    } else {
      // åªæ¸…ç©ºæ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»ï¼Œä¿ç•™å·²å®Œæˆçš„è·¯ç·šå’Œè·¯å¾‘é»
      routePlanningLayer.geoJsonData.features =
        routePlanningLayer.geoJsonData.features.filter(
          (f) =>
            f.properties.type !== 'route-planning-point' ||
            f.properties.status === 'completed'
        );
    }
    updateRoutePlanningLayerData(routePlanningLayer);
  }
};
```

## ğŸ¨ è¦–è¦ºæ•ˆæœ

### è·¯å¾‘é»ç‹€æ…‹å°æ¯”

| ç‹€æ…‹   | èƒŒæ™¯è‰²  | æ–‡å­—è‰²  | é‚Šæ¡†è‰²  | èªªæ˜                 |
| ------ | ------- | ------- | ------- | -------------------- |
| è¦åŠƒä¸­ | ğŸŸ  æ©˜è‰² | âšª ç™½è‰² | âšª ç™½è‰² | ç•¶å‰æ­£åœ¨è¦åŠƒçš„è·¯å¾‘é» |
| å·²å®Œæˆ | ğŸ”˜ ç°è‰² | ğŸ”˜ æ·ºç° | ğŸ”˜ æ·±ç° | å·²å®Œæˆè·¯ç·šçš„è·¯å¾‘é»   |

### åœ°åœ–é¡¯ç¤ºæ•ˆæœ

```
è·¯ç·š 1 (å·²å®Œæˆ):
ğŸ”˜1 â”€â”€â”€â”€ğŸ”˜2 â”€â”€â”€â”€ğŸ”˜3 â”€â”€â”€â”€ğŸ”˜4  (ç°è‰²è·¯å¾‘é» + æ©˜è‰²è·¯ç·š)

è·¯ç·š 2 (è¦åŠƒä¸­):
ğŸŸ 1 â”€â”€â”€â”€ğŸŸ 2                    (æ©˜è‰²è·¯å¾‘é»ï¼Œå°šç„¡è·¯ç·š)
```

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´çš„å¤šè·¯ç·šè¦åŠƒæµç¨‹

```
1. é–‹å§‹ç¬¬ä¸€æ¢è·¯ç·šè¦åŠƒ
   é»æ“Šã€Œé»é¸è·¯å¾‘è¦åŠƒé»ã€â†’ åœ°åœ–é»æ“Š â†’ é¡¯ç¤º ğŸŸ 1, ğŸŸ 2, ğŸŸ 3

2. å®Œæˆç¬¬ä¸€æ¢è·¯ç·š
   é»æ“Šã€Œè·¯å¾‘è¦åŠƒé»é¸å®Œæˆã€â†’ é¡¯ç¤ºæ©˜è‰²è·¯ç·š â†’ è·¯å¾‘é»è®Šæˆ ğŸ”˜1, ğŸ”˜2, ğŸ”˜3

3. é–‹å§‹ç¬¬äºŒæ¢è·¯ç·šè¦åŠƒ
   å†æ¬¡é»æ“Šã€Œé»é¸è·¯å¾‘è¦åŠƒé»ã€â†’ åœ°åœ–é»æ“Š â†’ é¡¯ç¤º ğŸŸ 1, ğŸŸ 2
   (æ–°çš„è·¯å¾‘é»ç·¨è™Ÿé‡æ–°å¾1é–‹å§‹ï¼Œèˆ‡å·²å®Œæˆçš„è·¯å¾‘é»å…±å­˜)

4. å®Œæˆç¬¬äºŒæ¢è·¯ç·š
   é»æ“Šã€Œè·¯å¾‘è¦åŠƒé»é¸å®Œæˆã€â†’ é¡¯ç¤ºç¬¬äºŒæ¢æ©˜è‰²è·¯ç·š â†’ æ–°è·¯å¾‘é»ä¹Ÿè®Šæˆç°è‰²

æœ€çµ‚çµæœï¼š
- åœ°åœ–ä¸ŠåŒæ™‚é¡¯ç¤ºå…©æ¢æ©˜è‰²è·¯ç·š
- æ‰€æœ‰è·¯å¾‘é»éƒ½ä¿ç•™åœ¨åœ°åœ–ä¸Šï¼Œä»¥ç°è‰²é¡¯ç¤º
- æ¯å€‹è·¯å¾‘é»éƒ½è¨˜éŒ„äº†æ‰€å±¬çš„è·¯ç·šç·¨è™Ÿ
```

## ğŸ“Š æ•¸æ“šçµæ§‹

### è·¯å¾‘é»æ•¸æ“šçµæ§‹

#### è¦åŠƒä¸­çš„è·¯å¾‘é»

```javascript
{
  type: 'Feature',
  geometry: { type: 'Point', coordinates: [lng, lat] },
  properties: {
    id: 'route_point_1640995200000_abc123',
    layerId: 'route-planning-layer',
    type: 'route-planning-point',
    name: 'è·¯å¾‘é» 1',
    order: 1,
    // status æœªè¨­ç½®ï¼Œè¡¨ç¤ºè¦åŠƒä¸­
    createdAt: '2024-01-15T10:30:00.000Z'
  }
}
```

#### å·²å®Œæˆçš„è·¯å¾‘é»

```javascript
{
  type: 'Feature',
  geometry: { type: 'Point', coordinates: [lng, lat] },
  properties: {
    id: 'route_point_1640995200000_abc123',
    layerId: 'route-planning-layer',
    type: 'route-planning-point',
    name: 'è·¯å¾‘é» 1',
    order: 1,
    status: 'completed',        // â† æ¨™è¨˜ç‚ºå·²å®Œæˆ
    routeId: 'route_1640995260000_def456',  // â† é—œè¯çš„è·¯ç·šID
    routeNumber: 1,             // â† æ‰€å±¬è·¯ç·šç·¨è™Ÿ
    createdAt: '2024-01-15T10:30:00.000Z'
  }
}
```

## âœ… ä¿®æ­£æ•ˆæœ

### ä¿®æ­£å‰çš„å•é¡Œ

- âŒ è·¯å¾‘è¦åŠƒå®Œæˆå¾Œè·¯å¾‘é»æ¶ˆå¤±
- âŒ ç„¡æ³•çœ‹åˆ°æ­·å²è·¯ç·šçš„è·¯å¾‘é»
- âŒ è·¯å¾‘é»èˆ‡è·¯ç·šæ²’æœ‰é—œè¯

### ä¿®æ­£å¾Œçš„æ•ˆæœ

- âœ… è·¯å¾‘é»æ°¸ä¹…ä¿ç•™åœ¨åœ°åœ–ä¸Š
- âœ… å·²å®Œæˆçš„è·¯å¾‘é»ä»¥ç°è‰²é¡¯ç¤º
- âœ… æ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»ä»¥æ©˜è‰²é¡¯ç¤º
- âœ… è·¯å¾‘é»èˆ‡è·¯ç·šæœ‰æ˜ç¢ºçš„é—œè¯é—œä¿‚
- âœ… å½ˆå‡ºè¦–çª—é¡¯ç¤ºè·¯å¾‘é»çš„è©³ç´°ç‹€æ…‹
- âœ… æ”¯æŒå¤šæ¢è·¯ç·šçš„è·¯å¾‘é»åŒæ™‚é¡¯ç¤º

## ğŸš€ æ¸¬è©¦é©—è­‰

### æ¸¬è©¦æ­¥é©Ÿ

1. **ç¬¬ä¸€æ¢è·¯ç·š**ï¼š

   - é»é¸ 3 å€‹è·¯å¾‘é» â†’ ç¢ºèªé¡¯ç¤º ğŸŸ 1, ğŸŸ 2, ğŸŸ 3
   - å®Œæˆè¦åŠƒ â†’ ç¢ºèªè·¯å¾‘é»è®Šæˆ ğŸ”˜1, ğŸ”˜2, ğŸ”˜3 ä¸”ä¿ç•™åœ¨åœ°åœ–ä¸Š

2. **ç¬¬äºŒæ¢è·¯ç·š**ï¼š

   - å†æ¬¡é–‹å§‹è¦åŠƒ â†’ é»é¸ 2 å€‹è·¯å¾‘é» â†’ ç¢ºèªé¡¯ç¤º ğŸŸ 1, ğŸŸ 2
   - å®Œæˆè¦åŠƒ â†’ ç¢ºèªæ–°è·¯å¾‘é»ä¹Ÿè®Šæˆç°è‰²

3. **æœ€çµ‚æª¢æŸ¥**ï¼š
   - åœ°åœ–ä¸ŠåŒæ™‚é¡¯ç¤ºå…©æ¢æ©˜è‰²è·¯ç·š
   - æ‰€æœ‰è·¯å¾‘é»éƒ½ä»¥ç°è‰²ä¿ç•™åœ¨åœ°åœ–ä¸Š
   - é»æ“Šè·¯å¾‘é»æŸ¥çœ‹å½ˆå‡ºè¦–çª—ï¼Œç¢ºèªç‹€æ…‹å’Œæ‰€å±¬è·¯ç·šä¿¡æ¯æ­£ç¢º

---

_ç¾åœ¨è·¯å¾‘è¦åŠƒé»æœƒæ°¸ä¹…ä¿ç•™åœ¨åœ°åœ–ä¸Šï¼Œå·²å®Œæˆçš„è·¯å¾‘é»ä»¥ç°è‰²é¡¯ç¤ºï¼Œæ­£åœ¨è¦åŠƒçš„è·¯å¾‘é»ä»¥æ©˜è‰²é¡¯ç¤ºï¼Œæä¾›å®Œæ•´çš„è·¯å¾‘è¦åŠƒæ­·å²è¨˜éŒ„ã€‚_
