<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWD97 åº§æ¨™è½‰æ›æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .coordinate-box {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .original { background: #fff3cd; }
        .converted { background: #d1ecf1; }
        .status { 
            padding: 5px 10px; 
            border-radius: 3px; 
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ TWD97 åº§æ¨™è½‰æ›æ¸¬è©¦</h1>
        <p>æ¸¬è©¦å°å—å¸‚ GeoJSON è³‡æ–™çš„åº§æ¨™ç³»çµ±æª¢æ¸¬å’Œè½‰æ›åŠŸèƒ½</p>

        <div class="test-section">
            <h2>ğŸ“ å°å—å¸‚å€å¯¦éš›åº§æ¨™ç¯„ä¾‹</h2>
            <div class="coordinate-box original">
                <strong>åŸå§‹ TWD97 åº§æ¨™ï¼š</strong><br>
                æ±åº§æ¨™ (X): 165295.003478<br>
                åŒ—åº§æ¨™ (Y): 2540755.067444
            </div>
            <div id="result1" class="coordinate-box converted">
                <strong>è½‰æ›å¾Œ WGS84 åº§æ¨™ï¼š</strong><br>
                <span id="converted1">è¨ˆç®—ä¸­...</span>
            </div>
            <div id="status1" class="status">ç‹€æ…‹: åˆå§‹åŒ–ä¸­</div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ å®‰å—å€å¯¦éš›åº§æ¨™ç¯„ä¾‹</h2>
            <div class="coordinate-box original">
                <strong>åŸå§‹ TWD97 åº§æ¨™ï¼š</strong><br>
                æ±åº§æ¨™ (X): 165091.617678<br>
                åŒ—åº§æ¨™ (Y): 2551702.102044
            </div>
            <div id="result2" class="coordinate-box converted">
                <strong>è½‰æ›å¾Œ WGS84 åº§æ¨™ï¼š</strong><br>
                <span id="converted2">è¨ˆç®—ä¸­...</span>
            </div>
            <div id="status2" class="status">ç‹€æ…‹: åˆå§‹åŒ–ä¸­</div>
        </div>

        <div class="test-section">
            <h2>ğŸ” åº§æ¨™ç³»çµ±æª¢æ¸¬æ¸¬è©¦</h2>
            <div id="detection-results">
                <p>æ­£åœ¨æª¢æ¸¬å„ç¨®åº§æ¨™æ ¼å¼...</p>
            </div>
        </div>
    </div>

    <script type="module">
        // ç°¡åŒ–ç‰ˆçš„ proj4 è½‰æ›å‡½æ•¸ï¼ˆåƒ…é©ç”¨æ–¼å°ç£åœ°å€ï¼‰
        function twd97ToWgs84Simple(x, y) {
            // TWD97 to WGS84 ç°¡åŒ–è½‰æ›å…¬å¼
            // é€™æ˜¯è¿‘ä¼¼å€¼ï¼Œå¯¦éš›å°ˆæ¡ˆä¸­æ‡‰ä½¿ç”¨ proj4js
            
            // TWD97 åƒæ•¸
            const a = 6378137.0; // é•·åŠè»¸
            const f = 1/298.257222101; // æ‰ç‡
            const k0 = 0.9999; // æ¯”ä¾‹å› å­
            const lon0 = 121.0; // ä¸­å¤®ç¶“ç·š
            const x0 = 250000.0; // æ±åç§»
            const y0 = 0.0; // åŒ—åç§»
            
            // ç°¡åŒ–è½‰æ›ï¼ˆå°ç£åœ°å€è¿‘ä¼¼ï¼‰
            const deltaX = x - x0;
            const deltaY = y - y0;
            
            // æ¦‚ç®—ç¶“ç·¯åº¦
            const lat = 23.0 + (deltaY / 111000.0);
            const lng = lon0 + (deltaX / (111000.0 * Math.cos(lat * Math.PI / 180)));
            
            return [lng, lat];
        }

        // åº§æ¨™ç³»çµ±æª¢æ¸¬
        function detectCoordinateSystem(coords) {
            const [x, y] = coords;
            
            // TWD97 ç¯„åœæª¢æ¸¬
            if (x >= 100000 && x <= 400000 && y >= 2400000 && y <= 2800000) {
                return 'TWD97';
            }
            
            // WGS84 ç¯„åœæª¢æ¸¬ï¼ˆå°ç£åœ°å€ï¼‰
            if (x >= 119 && x <= 122 && y >= 21.5 && y <= 25.5) {
                return 'WGS84';
            }
            
            return 'UNKNOWN';
        }

        // æ¸¬è©¦å‡½æ•¸
        function runTests() {
            console.log('ğŸš€ é–‹å§‹åº§æ¨™è½‰æ›æ¸¬è©¦...');
            
            // æ¸¬è©¦é» 1: å°å—å¸‚å—å€
            const point1 = [165295.003478, 2540755.067444];
            const converted1 = twd97ToWgs84Simple(point1[0], point1[1]);
            const detection1 = detectCoordinateSystem(point1);
            
            document.getElementById('converted1').innerHTML = `
                ç¶“åº¦: ${converted1[0].toFixed(6)}<br>
                ç·¯åº¦: ${converted1[1].toFixed(6)}
            `;
            document.getElementById('status1').innerHTML = `ç‹€æ…‹: æª¢æ¸¬ç‚º ${detection1}`;
            document.getElementById('status1').className = 'status success';
            
            // æ¸¬è©¦é» 2: å°å—å¸‚å®‰å—å€
            const point2 = [165091.617678, 2551702.102044];
            const converted2 = twd97ToWgs84Simple(point2[0], point2[1]);
            const detection2 = detectCoordinateSystem(point2);
            
            document.getElementById('converted2').innerHTML = `
                ç¶“åº¦: ${converted2[0].toFixed(6)}<br>
                ç·¯åº¦: ${converted2[1].toFixed(6)}
            `;
            document.getElementById('status2').innerHTML = `ç‹€æ…‹: æª¢æ¸¬ç‚º ${detection2}`;
            document.getElementById('status2').className = 'status success';
            
            // åº§æ¨™ç³»çµ±æª¢æ¸¬æ¸¬è©¦
            const testCoords = [
                { name: 'TWD97 ç¯„ä¾‹', coords: [165295, 2540755] },
                { name: 'WGS84 ç¯„ä¾‹', coords: [120.2, 23.0] },
                { name: 'éŒ¯èª¤åº§æ¨™', coords: [999, 999] }
            ];
            
            let detectionHTML = '<h3>æª¢æ¸¬çµæœ:</h3>';
            testCoords.forEach(test => {
                const result = detectCoordinateSystem(test.coords);
                detectionHTML += `<p><strong>${test.name}</strong> [${test.coords.join(', ')}]: 
                    <span class="status ${result === 'UNKNOWN' ? 'error' : 'success'}">${result}</span></p>`;
            });
            
            document.getElementById('detection-results').innerHTML = detectionHTML;
            
            console.log('âœ… åº§æ¨™è½‰æ›æ¸¬è©¦å®Œæˆ');
            console.log('çµæœ 1:', { original: point1, converted: converted1, detected: detection1 });
            console.log('çµæœ 2:', { original: point2, converted: converted2, detected: detection2 });
        }

        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œæ¸¬è©¦
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html> 